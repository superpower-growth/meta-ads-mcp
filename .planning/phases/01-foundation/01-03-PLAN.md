---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Implement MCP server skeleton with HTTP transport and basic tool registry, integrating with Meta API client for end-to-end verification.

Purpose: Create working MCP server that can accept remote connections and expose initial tool structure, demonstrating full integration between MCP protocol and Meta Marketing API.
Output: Running MCP server on HTTP transport that responds to protocol messages and can be tested with MCP client.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**From RESEARCH.md - MCP Server Pattern:**
```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { createHTTPServer } from '@modelcontextprotocol/node';

const server = new Server(
  {
    name: 'meta-ads-mcp',
    version: '1.0.0',
  },
  {
    capabilities: {
      tools: {},
    },
  }
);

// Register tools
server.setRequestHandler('tools/list', async () => ({
  tools: [...],
}));

// Create HTTP server (for remote deployment)
const httpServer = createHTTPServer(server);
httpServer.listen(3000);
```

**Don't hand-roll (from RESEARCH.md):**
- MCP transport layer - use @modelcontextprotocol/node
- Protocol compliance - Server class handles this
- Input validation - use Zod schemas (already required by MCP SDK)

**Critical for remote deployment:**
- Use HTTP transport (not stdio) - stdio is local-only
- Prepare for OAuth 2.1 (coming in MCP SDK v2.0 Q1 2026)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement MCP server skeleton with HTTP transport</name>
  <files>src/index.ts, src/tools/index.ts, src/lib/validation.ts</files>
  <action>
Update src/index.ts to create MCP server:
- Import Server from '@modelcontextprotocol/sdk/server/index.js'
- Import StdioServerTransport from '@modelcontextprotocol/sdk/server/stdio.js' (for initial testing)
- Import env config
- Create Server instance with name "meta-ads-mcp", version "0.1.0"
- Set capabilities: { tools: {} }
- Register tools/list handler returning empty array initially
- Connect transport and start server
- Add error handling for server.connect() failures
- Log "MCP server started" on successful startup

Create src/tools/index.ts with empty tool registry (will be populated in Phase 2).

Create src/lib/validation.ts with helper to create Zod schemas for MCP tool inputs. Export function `createToolSchema(schema: z.ZodSchema)` that wraps schema with proper error formatting.

Use stdio transport initially (simpler for testing). We'll add HTTP transport after verifying stdio works. Avoid starting HTTP server without testing stdio first - if MCP protocol is broken, HTTP won't help debug it.

Add comment: "TODO: Switch to HTTP transport after verification (for remote deployment)"
  </action>
  <verify>
cat src/index.ts | grep "Server" shows MCP Server import
cat src/index.ts | grep "meta-ads-mcp" shows server name
cat src/index.ts | grep "tools/list" shows handler registration
cat src/index.ts | grep "server.connect" shows transport connection
cat src/tools/index.ts exists (tool registry file created)
cat src/lib/validation.ts | grep "createToolSchema" shows helper function
npm run type-check passes with no errors
npm run build succeeds and creates build/index.js
  </verify>
  <done>
MCP server created with stdio transport, tools/list handler registered, tool registry structure established, validation helpers created, builds without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add basic MCP tool for Meta API integration test</name>
  <files>src/tools/get-account.ts, src/tools/index.ts (updated)</files>
  <action>
Create src/tools/get-account.ts implementing simple MCP tool to test Meta API integration:
- Import api from '../meta/client.js'
- Import AdAccount from facebook-nodejs-business-sdk
- Import z from zod
- Define input schema with zod: { accountId: z.string() }
- Implement tool handler that:
  - Creates AdAccount instance with provided accountId
  - Calls account.get(['name', 'account_id', 'currency'])
  - Returns account info as formatted text in MCP response
  - Catches and formats errors (use error handling pattern from RESEARCH.md)

Update src/tools/index.ts to export tool list including get-account tool.

Update src/index.ts to import tool list from tools/index.ts and register in tools/list handler.

This tool serves as integration verification - if it works, both MCP server and Meta API client are functioning correctly.

Avoid complex tools at this stage - just prove the integration works. Avoid implementing multiple tools - one simple tool is enough to verify the pattern.
  </action>
  <verify>
cat src/tools/get-account.ts | grep "AdAccount" shows Meta SDK import
cat src/tools/get-account.ts | grep "account.get" shows API call
cat src/tools/get-account.ts | grep "z.string()" shows zod validation
cat src/tools/index.ts | grep "get-account" shows tool exported
cat src/index.ts | grep "tools/list" shows updated handler
npm run type-check passes
npm run build succeeds
  </verify>
  <done>
Basic MCP tool created to query Meta ad account info, tool registry updated, MCP server can list and call the tool, integration between MCP and Meta API verified through tool implementation
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build succeeds without errors
- [ ] npm run type-check passes with no TypeScript errors
- [ ] MCP server starts with: node build/index.js (logs "MCP server started")
- [ ] tools/list handler returns at least one tool (get-account)
- [ ] Tool schema uses zod validation
- [ ] Tool implementation imports Meta API client correctly
- [ ] README.md created with setup instructions (optional but recommended)
</verification>

<success_criteria>
- MCP server skeleton implemented with stdio transport
- Server starts successfully and logs confirmation
- tools/list handler registered and returns tool definitions
- Basic Meta API integration tool created (get-account)
- Integration between MCP protocol and Meta SDK verified
- Build and type-check pass without errors
- Phase 1 Foundation complete - ready for Phase 2 Core Metrics Query
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`:

# Phase 1 Plan 03: MCP Server Setup Summary

**MCP server skeleton with stdio transport and basic Meta API integration tool demonstrating end-to-end connectivity**

## Accomplishments
- MCP server implemented with protocol-compliant tools capability
- stdio transport connected and server starts successfully
- Tool registry structure established for extensibility
- Basic get-account tool demonstrates Meta API + MCP integration
- Validation helpers created for consistent input schema handling

## Files Created/Modified
- `src/index.ts` - MCP server initialization and startup (updated from placeholder)
- `src/tools/index.ts` - Tool registry for MCP tool definitions
- `src/tools/get-account.ts` - Basic tool to query Meta ad account info
- `src/lib/validation.ts` - Zod schema helpers for tool inputs

## Decisions Made
- stdio transport initially - Simpler for testing, will switch to HTTP for remote deployment in later phase
- Single basic tool - Proves integration pattern without over-engineering
- Zod for all validation - Consistent with MCP SDK requirements, reusable patterns

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None

## Next Phase Readiness
**Phase 1: Foundation is complete**

Foundation established:
- ✅ TypeScript project with proper configuration
- ✅ Meta Marketing API client with v25.0 versioning
- ✅ MCP server with protocol compliance
- ✅ Integration verified (MCP tools can call Meta API)

Ready for Phase 2: Core Metrics Query
- MCP server can be extended with more tools
- Meta API client ready for Insights API calls
- Tool pattern established for rapid development

**Blockers/Concerns:**
None - foundation is solid. Note: stdio transport is local-only; Phase 10 (Integration & Polish) will switch to HTTP/SSE for remote team access.

## Next Step
Phase 1 complete - proceed to Phase 2 planning: `/gsd:plan-phase 2`
</output>
