---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Create Meta Marketing API client module with proper initialization, versioning, and connectivity testing.

Purpose: Establish working connection to Meta Marketing API using official SDK patterns from RESEARCH.md, verifying authentication works and API is accessible.
Output: Functional Meta API client module that can authenticate and query ad account data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**From RESEARCH.md - Meta API Client Pattern:**
```typescript
import { FacebookAdsApi } from 'facebook-nodejs-business-sdk';

const accessToken = process.env.META_ACCESS_TOKEN;
const api = FacebookAdsApi.init(accessToken);

// Set API version explicitly (Q1 2026: use v25+)
api.setVersion('v25.0');

export { api };
```

**Critical pitfalls to avoid (from RESEARCH.md):**
- NOT setting explicit API version - Meta deprecates versions every 90 days
- Hardcoding access token - use environment variables
- Not handling rate limits - SDK has built-in handling
- Not checking token permissions - need ads_read and ads_management

**Don't hand-roll (from RESEARCH.md):**
- OAuth flows - use FacebookAdsApi.init()
- Rate limiting - SDK handles this
- API versioning - use api.setVersion()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Meta API client initialization module</name>
  <files>src/meta/client.ts, src/config/env.ts, .env.example (updated)</files>
  <action>
Create src/config/env.ts to load and validate environment variables. Use zod to validate META_ACCESS_TOKEN and META_AD_ACCOUNT_ID are present. Throw descriptive error if missing (not just undefined checks - zod provides better error messages).

Create src/meta/client.ts following Pattern 1 from RESEARCH.md:
- Import FacebookAdsApi from facebook-nodejs-business-sdk
- Import env config
- Initialize API with access token from env
- Set explicit API version to v25.0 (current as of Q1 2026)
- Export initialized api instance

Add validation: if access token is empty/undefined, throw clear error: "META_ACCESS_TOKEN environment variable is required. See .env.example for setup."

Update .env.example with:
- META_ACCESS_TOKEN=your_token_here (with comment explaining how to get it)
- META_AD_ACCOUNT_ID=act_123456789 (with format note)
- PORT=3000 (for MCP server in next plan)

Avoid using api.setDebug() in production - only for development. Avoid hardcoding version string in multiple places - define VERSION constant at top of file.
  </action>
  <verify>
ls src/config/ shows env.ts
ls src/meta/ shows client.ts
cat src/config/env.ts | grep "zod" shows zod import
cat src/meta/client.ts | grep "v25.0" shows API version set
cat src/meta/client.ts | grep "FacebookAdsApi.init" shows SDK initialization
cat .env.example | grep "META_ACCESS_TOKEN" shows token placeholder
npm run type-check passes with no errors
  </verify>
  <done>
Meta API client module created with explicit v25.0 versioning, environment config uses zod validation, .env.example updated with token placeholders, no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Test Meta API connectivity with ad account query</name>
  <files>src/meta/test-connection.ts</files>
  <action>
Create src/meta/test-connection.ts as a standalone script to verify Meta API connectivity:
- Import api from ./client.ts
- Import AdAccount from facebook-nodejs-business-sdk
- Load META_AD_ACCOUNT_ID from env
- Create AdAccount instance
- Call account.get(['name', 'account_id', 'currency']) to fetch basic account info
- On success: log account name and ID
- On error: catch and log detailed error (check for 190 token error, 100 permission error, 17/32 rate limit)

Add error handling patterns from RESEARCH.md code examples - Meta API errors have specific structure with error.response.error.code.

Add comment in file: "This is a test script. Run with: tsx src/meta/test-connection.ts after setting META_ACCESS_TOKEN in .env"

DO NOT run this script during execution (we don't have real token yet). Just create the file for manual testing. The verification step will ensure it compiles, not that it runs.

Avoid using console.log for errors - use console.error. Avoid generic error messages - include the Meta error code and message for debugging.
  </action>
  <verify>
ls src/meta/ shows test-connection.ts
cat src/meta/test-connection.ts | grep "AdAccount" shows import
cat src/meta/test-connection.ts | grep "account.get" shows API call
cat src/meta/test-connection.ts | grep "error.response" shows error handling
npm run type-check passes (file compiles without TypeScript errors)
  </verify>
  <done>
Test connection script created with proper error handling for Meta API error codes (190, 100, 17, 32), compiles without errors, ready for manual testing with real token
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run type-check passes with no TypeScript errors
- [ ] src/meta/client.ts exports initialized FacebookAdsApi instance
- [ ] API version explicitly set to v25.0
- [ ] Environment variables validated with zod
- [ ] Test script compiles and handles Meta API error codes
- [ ] .env.example has clear instructions for obtaining tokens
</verification>

<success_criteria>
- Meta API client module created and exports working API instance
- API version explicitly set (v25.0) to avoid deprecation issues
- Environment configuration validates required variables with zod
- Test connection script ready for manual verification with real token
- Error handling follows Meta API error code patterns (190, 100, 17, 32)
- No TypeScript compilation errors
- Ready for MCP server implementation (Plan 01-03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`:

# Phase 1 Plan 02: Meta API Integration Summary

**Meta Marketing API client initialized with v25.0 versioning, environment validation, and test connectivity script**

## Accomplishments
- Meta API client module with FacebookAdsApi initialization
- Explicit API versioning (v25.0) to prevent quarterly deprecation issues
- Environment configuration with zod validation for required tokens
- Test connection script with comprehensive error handling

## Files Created/Modified
- `src/meta/client.ts` - FacebookAdsApi initialization with v25.0 versioning
- `src/config/env.ts` - Environment variable validation with zod
- `src/meta/test-connection.ts` - Test script for manual API connectivity verification
- `.env.example` - Updated with META_ACCESS_TOKEN and META_AD_ACCOUNT_ID placeholders

## Decisions Made
- API version v25.0 - Current version as of Q1 2026, avoids deprecated ASC/AAC APIs
- zod for env validation - Already a dependency from MCP SDK, reuse for consistency
- Separate test script - Allows manual verification without embedding in server startup

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None

## Next Phase Readiness
- Meta API client ready for MCP tool integration
- Environment configuration established for all modules
- Error handling patterns ready for production use

## Next Step
Ready for 01-03-PLAN.md (MCP Server Setup)
</output>
